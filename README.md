<br />
<div align="center">
  <a href="https://github.com/Rev-1b/MirGovoritTest">
  </a>

<h3 align="center">Тех-задание для 'Ап-Трейдер'</h3>

  <p align="center">
    Документация по установке и работе с приложением древовидного меню
    <br />В самом низу README я подробно описал свои решения по проекту
</div>


## Используемые технологии

- **Веб-фреймворк:** Джанго
- **База данных:** Django ORM с SQLite (по умолчанию) или PostgreSQL (для рабочей среды).
- **Docker:** контейнеризация для разработки и развертывания.
- **Тестирование:** встроенная среда тестирования Django.
- **Оптимизация:** django-debug-toolbar для контроля поведения приложения

## Установка и настройка

### Локальная разработка

1. **Клонируйте репозиторий:**

    ```bash
    git clone https://github.com/Rev-1b/WeatherTest.git
    ```

2. **Установите зависимости:**

    ```bash
    pip install -r requirements.txt
    ```

3. **Примените миграции:**

    ```bash
    python manage.py migrate
    ```

4. **Запустите сервер:**

    ```bash
    python manage.py runserver
    ```

   Сайт будет доступен по адресу `http://localhost:8000`.

### Docker

1. **Запустите docker-compose:**

    ```bash
    docker-compose up --build
    ```

   Сайт будет доступен по адресу `http://localhost:8000`.

## Структура проекта и использование

В проекте есть две модели. Объекты первой являются <span style="color: blue;">объектами меню</span>. Так же их можно воспринимать как самый верхний пункт меню. По умолчанию, на странице отображаются все объекты из этой модели, с возможностью кликнуть по ним.
При нажатии на любой пункт меню произойдет переход по ссылке, в которой будет указан как слаг выбранного пункта меню, так и слаг объекта меню, которому принадлежит пункт меню (Разделение на меню и пункты меню нужно для оптимизации)


## Тестирование

Для запуска тестов, выполните команду, находясь в одной директории с manage.py:

```bash
python manage.py test
```

Эту команду можно запустить как из IDE, так и из docker контейнера.

## Комментарии по проекту

- **База данных:** Для удобства проверки, сейчас проект работает на SQLite3. Однако, в docker-compose есть закомментированный участок, который запускает PostgreSQL. При необходимости, надо раскомментировать все строчки в docker-compose, и поменять DATABASES в файле settings.py
- **Количество запросов:** Всего на рендер всей страницы уходит 2 запроса. При этом, 1 запрос нужен для отрисовки всех пунктов выбранного меню вне зависимости от глубины, а еще один для отображения всех доступных меню. По тех заданию, отрисовка должна занимать ровно 1 запрос, что и было сделано. 2ого запроса не будет, если использовать приложение именно так, как указано в тз.
- **Принцип работы:** Отображение страницы происходит в 2 основных этапа: Создание словаря, в котором уже есть структура древовидного меню, и рекурсивное отображение этого словаря в шаблоне.
- **Создание словаря меню:** При начале генерации словаря меню мы сразу отсекаем все пункты меню, которые не принадлежат выбранному меню(для этого и было сделано разделение на две модели). Далее формируются вспомогательные словари, которые необходимы для уменьшения количества запросов в бд. На основе вспомогательных словарей формируется результирующий словарь, который и передается в контекст для отображения.
- **Рендеринг меню:** Рендеринг происходит рекурсивно, начиная с самого верхнего пункта меню. Вначале отрисовывается сам пункт и все его дочерние элементы на один уровень вложенности вглубь. Если один из дочерних элементов есть в словаре menu, то это значит, что он стоит на пути до выбранного пункта меню. Для реализации рекурсии я внутри шаблона тега {% draw_menu %} вызываю этот самый тег, но через with передаю именно тот дочерний элемент, который присутствует в menu. Таким образом, рекурсия остановится сама, как только ни один из дочерних элементов текущего пункта не будет присутствовать в словаре menu


